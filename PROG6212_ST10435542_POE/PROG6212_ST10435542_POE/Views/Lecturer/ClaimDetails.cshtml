@using PROG6212_ST10435542_POE.Models.Enums
@using PROG6212_ST10435542_POE.Models.ViewModels.Approval

@model ClaimDetailsViewModel
@{
    ViewData["Title"] = "My Claim Details";
}

@* I made use of Empty Razor View and incorporated code from previous MVC projects and made minor tweaks to my liking *@
@* These views mainly made use of the ViewModels ive created in order to manipulate which data i wanted in specific views, instead of the mai models according to the database schema *@

<h1>My Claim Details</h1>

<div class="row">
    <div class="col-md-8">
        <dl class="row">
            <dt class="col-sm-4">Lecturer Name:</dt>
            <dd class="col-sm-8">@Model.LecturerName</dd>

            <dt class="col-sm-4">Submission Date:</dt>
            <dd class="col-sm-8">@Model.SubmissionDate.ToString("dd/MM/yyyy")</dd>

            <dt class="col-sm-4">Claim Period:</dt>
            <dd class="col-sm-8">@Model.ClaimPeriod.ToString("MMMM yyyy")</dd>

            <dt class="col-sm-4">Total Hours Worked:</dt>
            <dd class="col-sm-8">@Model.TotalHoursWorked</dd>

            <dt class="col-sm-4">Total Amount Claimed:</dt>
            <dd class="col-sm-8">@($"R {Model.TotalAmount:N2}")</dd>

            <dt class="col-sm-4">Current Status:</dt>
            <dd class="col-sm-8">@Model.Status</dd>

            @if (!string.IsNullOrEmpty(Model.Notes))
            {
                <dt class="col-sm-4">Notes:</dt>
                <dd class="col-sm-8">@Model.Notes</dd>
            }
        </dl>
    </div>
</div>

<hr />

<!-- Detailed Work Entries -->
<div class="row mt-4">
    <div class="col-md-8">
        <h4>Detailed Work Entries:</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Date Worked</th>
                    <th>Hours</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ClaimDetails != null && Model.ClaimDetails.Count > 0)
                {
                    foreach (var entry in Model.ClaimDetails)
                    {
                        <tr>
                            <td>@entry.DateWorked.ToString("dd/MM/yyyy")</td>
                            <td>@entry.HoursWorked</td>
                            <td>@entry.TaskDescription</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="3" class="text-center"> No work entries added yet. </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<p></p>

<!-- Supporting Documents -->
<div class="row mt-4">
    <div class="col-md-8">
        <h4>Supporting Documents</h4>
        @if (Model.Documents != null && Model.Documents.Any())
        {
            <ul class="list-group">
                @foreach (var doc in Model.Documents)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        @doc.FileName
                        <span class="badge bg-secondary">@doc.DisplaySize</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p>No supporting documents uploaded.</p>
        }
    </div>
</div>
<p></p>
<!-- Approval History -->
<div class="row mt-4">
    <div class="col-md-8">
        <h4>Approval History</h4>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Approver</th>
                    <th>Role</th>
                    <th>Action</th>
                    <th>Date</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ApprovalHistory != null && Model.ApprovalHistory.Any())
                {
                    foreach (var approval in Model.ApprovalHistory)
                    {
                        <tr>
                            <td>@approval.ApproverName</td>
                            <td>@approval.ApproverRole</td>
                            <td>
                                <span class="badge @(approval.ApprovalStatus == ClaimApprovalStatusEnum.Approved ? "bg-success" :
                                                                                            approval.ApprovalStatus == ClaimApprovalStatusEnum.Rejected ? "bg-danger" :
                                                                                            approval.ApprovalStatus == ClaimApprovalStatusEnum.Pending ? "bg-warning" : "bg-info")">
                                @approval.ApprovalStatus
                        </span>
                            </td>
                            <td>@approval.ApprovalDate.ToString("dd/MM/yyyy")</td>
                            <td>@approval.Comments</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center"> No approval history yet. </td>
                    </tr>
                }
            </tbody>
        </table>
        <p></p>
        <a asp-controller="Lecturer" asp-action="ClaimStatusTracker" class="btn btn-outline-primary">Back to My Claims</a>
    </div>
</div>

        