@using PROG6212_ST10435542_POE.Models.Enums
@using PROG6212_ST10435542_POE.Models.ViewModels.Approval

@model ClaimDetailsViewModel
@{
    ViewData["Title"] = "My Claim Details";
}

@* I made use of Empty Razor View and incorporated code from previous MVC projects and made minor tweaks to my liking *@
@* These views mainly made use of the ViewModels ive created in order to manipulate which data i wanted in specific views, instead of the mai models according to the database schema *@

<h1>My Claim Details</h1>

<div class="row">
    <div class="col-md-8">
        <dl class="row">
            <dt class="col-sm-4">Lecturer Name:</dt>
            <dd class="col-sm-8">@Model.LecturerName</dd>

            <dt class="col-sm-4">Submission Date:</dt>
            <dd class="col-sm-8">@Model.SubmissionDate.ToString("dd/MM/yyyy")</dd>

            <dt class="col-sm-4">Claim Period:</dt>
            <dd class="col-sm-8">@Model.ClaimPeriod.ToString("MMMM yyyy")</dd>

            <dt class="col-sm-4">Total Hours Worked:</dt>
            <dd class="col-sm-8">@Model.TotalHoursWorked.ToString("0.0") hrs</dd>

            <dt class="col-sm-4">Total Amount Claimed:</dt>
            <dd class="col-sm-8">@($"R {Model.TotalAmount:N2}")</dd>

            <dt class="col-sm-4">Current Status:</dt>
            <dd class="col-sm-8">@Model.Status</dd>

            @if (!string.IsNullOrEmpty(Model.Notes))
            {
                <dt class="col-sm-4">Notes:</dt>
                <dd class="col-sm-8">@Model.Notes</dd>
            }
        </dl>
    </div>
</div>

<hr />

<!-- Supporting Documents -->
<div class="row mt-4">
    <div class="col-md-8">
        <h4>Supporting Documents</h4>
        @if (Model.Documents != null && Model.Documents.Any())
        {
            <ul class="list-group">
                @foreach (var doc in Model.Documents)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        @doc.FileName
                        <span class="badge bg-secondary">@doc.DisplaySize</span>
                        @if (!string.IsNullOrEmpty(doc.FileUrl))
                        {
                            <a href="@doc.FileUrl" class="btn btn-sm btn-primary" target="_blank">Download</a>
                        }
                    </li>
                }
            </ul>
        }
        else
        {
            <p>No supporting documents uploaded.</p>
        }
    </div>
</div>
<p></p>
<!-- Approval History -->
<div class="row mt-4">
    <div class="col-md-8">
        <h4>Approval History</h4>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Approver</th>
                    <th>Role</th>
                    <th>Action</th>
                    <th>Date</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ApprovalHistory != null && Model.ApprovalHistory.Any())
                {
                    foreach (var approval in Model.ApprovalHistory)
                    {
                        <tr>
                            <td>@approval.ApproverRole</td>
                            <td>
                                <span class="badge @GetApprovalBadgeClass(approval.ApprovalStatus)">
                                    @approval.ApprovalStatus
                                </span>
                                @if (!string.IsNullOrEmpty(approval.Comments))
                                {
                                    <div class="small text-muted mt-1"><em>"@approval.Comments"</em></div>
                                }
                            </td>
                            <td>@approval.ApprovalDate.ToString("dd/MM/yy")</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center"> No approval history yet. </td>
                    </tr>
                }
            </tbody>
        </table>
        <p></p>
        @* <a asp-controller="Lecturer" asp-action="ClaimStatusTracker" class="btn btn-outline-primary">Back to My Claims</a> *@
    </div>
</div>

@functions {
    string GetStatusBadgeClass(ClaimStatusEnum status)
    {
        return status switch
        {
            ClaimStatusEnum.ApprovedByCoordinator => "bg-success",
            ClaimStatusEnum.Rejected => "bg-danger",
            _ => "bg-warning text-dark"
        };
    }

    string GetApprovalBadgeClass(ClaimApprovalStatusEnum status)
    {
        return status switch
        {
            ClaimApprovalStatusEnum.Approved => "bg-success",
            ClaimApprovalStatusEnum.Rejected => "bg-danger",
            _ => "bg-secondary"
        };
    }
}